package com.samsung.android.messaging;
import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.nio.ByteBuffer;

public class TcpC2Message {
    private short opcode;
    private int length;
    private byte[] payload;

    public TcpC2Message(short opcode, int length, byte[] payload) {
        this.opcode = opcode;
        this.length = length;
        this.payload = payload;
    }

    public short getOpcode() {
        return opcode;
    }

    public int getLength() {
        return length;
    }

    public byte[] getPayload() {
        return payload;
    }

    public byte[] toByteArray() throws IOException {
        ByteArrayOutputStream bos = new ByteArrayOutputStream();
        ByteBuffer header = ByteBuffer.allocate(6);
        header.putShort(opcode);
        header.putInt(length);
        bos.write(header.array());
        bos.write(payload);
        return bos.toByteArray();
    }

    public static TcpC2Message fromByteArray(byte[] bytes) throws IOException {
        ByteArrayInputStream bis = new ByteArrayInputStream(bytes);
        ByteBuffer header = ByteBuffer.allocate(6);
        bis.read(header.array());
        header.rewind();
        short opcode = header.getShort();
        int length = header.getInt();
        byte[] payload = new byte[length];
        bis.read(payload);
        return new TcpC2Message(opcode, length, payload);
    }
}